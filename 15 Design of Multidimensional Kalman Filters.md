<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>15 Design of Multidimensional Kalman Filters</title>
  <link rel="stylesheet" href="https://stackedit.io/style.css" />
</head>

<body class="stackedit">
  <div class="stackedit__left">
    <div class="stackedit__toc">
      
<ul>
<li><a href="#design-of-multi-dimensional-kalman-filters">Design of Multi-Dimensional Kalman Filters</a>
<ul>
<li><a href="#state-transition">State Transition</a></li>
<li><a href="#measurement-update">Measurement Update</a></li>
<li><a href="#kalman-gain">Kalman Gain</a></li>
<li><a href="#kalman-filter-equations">Kalman Filter Equations</a></li>
</ul>
</li>
</ul>

    </div>
  </div>
  <div class="stackedit__right">
    <div class="stackedit__html">
      <h1 id="design-of-multi-dimensional-kalman-filters">Design of Multi-Dimensional Kalman Filters</h1>
<p><a href="https://www.youtube.com/watch?v=9Xb5WavDqKE"><img src="https://preview.ibb.co/f60S08/capture_screen_1.png" alt=""></a></p>
<p>To implement a two dimensional Kalman Filter, you will need to apply several linear algebra equations. To begin with, let’s convert the state prediction into linear algebra form. This is helpful because linear algebra allows us to work easily with multi-dimensional problems.</p>
<h2 id="state-transition">State Transition</h2>
<p>We know that the update formula below represents the relationship between the robot’s position,  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi>x</mi></mstyle></mrow><annotation encoding="application/x-tex">\large x</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.516672em;"></span><span class="strut bottom" style="height: 0.516672em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit sizing reset-size6 size7">x</span></span></span></span></span>, and velocity,  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mover accent="true"><mrow><mi>x</mi></mrow><mo>˙</mo></mover></mstyle></mrow><annotation encoding="application/x-tex">\large \dot{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.801432em;"></span><span class="strut bottom" style="height: 0.801432em; vertical-align: 0em;"></span><span class="base"><span class="mord accent sizing reset-size6 size7"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.66786em;"><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="accent-body" style="margin-left: 0.05556em;"><span class="">˙</span></span></span></span></span></span></span></span></span></span></span>. We can also assume that the robot’s velocity is not changing, as we have no information to support any other conclusion.</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><msup><mi>x</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mi>x</mi><mo>+</mo><mi mathvariant="normal">Δ</mi><mi>t</mi><mover accent="true"><mrow><mi>x</mi></mrow><mo>˙</mo></mover></mstyle></mrow><annotation encoding="application/x-tex">\large x' = x + \Delta t \dot{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.940048em;"></span><span class="strut bottom" style="height: 1.04004em; vertical-align: -0.099996em;"></span><span class="base"><span class="mord sizing reset-size6 size7"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.783373em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel sizing reset-size6 size7">=</span><span class="mord mathit sizing reset-size6 size7">x</span><span class="mbin sizing reset-size6 size7">+</span><span class="mord mathrm sizing reset-size6 size7">Δ</span><span class="mord mathit sizing reset-size6 size7">t</span><span class="mord accent sizing reset-size6 size7"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.66786em;"><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="accent-body" style="margin-left: 0.05556em;"><span class="">˙</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><msup><mover accent="true"><mrow><mi>x</mi></mrow><mo>˙</mo></mover><mo mathvariant="normal">′</mo></msup><mo>=</mo><mover accent="true"><mrow><mi>x</mi></mrow><mo>˙</mo></mover></mstyle></mrow><annotation encoding="application/x-tex">\large \dot{x}' = \dot{x}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.940048em;"></span><span class="strut bottom" style="height: 0.940048em; vertical-align: 0em;"></span><span class="base"><span class="mord sizing reset-size6 size7"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.66786em;"><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="accent-body" style="margin-left: 0.05556em;"><span class="">˙</span></span></span></span></span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.783373em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel sizing reset-size6 size7">=</span><span class="mord accent sizing reset-size6 size7"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.66786em;"><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="accent-body" style="margin-left: 0.05556em;"><span class="">˙</span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>Let’s see how these two equations would look if they were re-written as a linear algebra equation. On the left, is the posterior state (denoted with the prime symbol,  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><msup><mrow></mrow><mo mathvariant="normal">′</mo></msup><mtext>&nbsp;</mtext></mstyle></mrow><annotation encoding="application/x-tex">\large '\space</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.880048em;"></span><span class="strut bottom" style="height: 0.880048em; vertical-align: 0em;"></span><span class="base"><span class="mord sizing reset-size6 size7"><span class=""></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.733373em;"><span class="" style="top: -3.163em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mspace sizing reset-size6 size7">&nbsp;</span></span></span></span></span>), and on the right are the state transition function and the prior state. This equation shows how the state changes over the time period,  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi mathvariant="normal">Δ</mi><mi>t</mi></mstyle></mrow><annotation encoding="application/x-tex">\large \Delta t</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.819996em;"></span><span class="strut bottom" style="height: 0.819996em; vertical-align: 0em;"></span><span class="base"><span class="mord mathrm sizing reset-size6 size7">Δ</span><span class="mord mathit sizing reset-size6 size7">t</span></span></span></span></span>.</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><msup><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mover accent="true"><mrow><mi>x</mi></mrow><mo>˙</mo></mover></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo mathvariant="normal">′</mo></msup><mo>=</mo><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi mathvariant="normal">Δ</mi><mrow><mi>t</mi></mrow></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mover accent="true"><mrow><mi>x</mi></mrow><mo>˙</mo></mover></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mstyle></mrow><annotation encoding="application/x-tex">\large \begin{bmatrix} x \\ \dot{x} \end{bmatrix}' = \begin{bmatrix} 1 &amp; \Delta{t} \\ 0 &amp; 1 \end{bmatrix} \begin{bmatrix} x \\ \dot{x} \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 1.97205em;"></span><span class="strut bottom" style="height: 3.16208em; vertical-align: -1.19003em;"></span><span class="base"><span class="minner sizing reset-size6 size7"><span class="minner"><span class="mopen sizing reset-size7 size6 delimcenter" style="top: -0.05em;"><span class="delimsizing size4">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.81em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span class="" style="top: -2.61em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.66786em;"><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="accent-body" style="margin-left: 0.05556em;"><span class="">˙</span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"></span></span></span></span></span></span><span class="mclose sizing reset-size7 size6 delimcenter" style="top: -0.05em;"><span class="delimsizing size4">]</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 1.64337em;"><span class="" style="top: -4.073em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel sizing reset-size6 size7">=</span><span class="minner sizing reset-size6 size7"><span class="mopen sizing reset-size7 size6 delimcenter" style="top: -0.05em;"><span class="delimsizing size4">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.81em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathrm">1</span></span></span><span class="" style="top: -2.61em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathrm">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.81em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathrm">Δ</span><span class="mord"><span class="mord mathit">t</span></span></span></span><span class="" style="top: -2.61em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathrm">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"></span></span></span></span></span></span><span class="mclose sizing reset-size7 size6 delimcenter" style="top: -0.05em;"><span class="delimsizing size4">]</span></span></span><span class="minner sizing reset-size6 size7"><span class="mopen sizing reset-size7 size6 delimcenter" style="top: -0.05em;"><span class="delimsizing size4">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.81em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span class="" style="top: -2.61em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.66786em;"><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="accent-body" style="margin-left: 0.05556em;"><span class="">˙</span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"></span></span></span></span></span></span><span class="mclose sizing reset-size7 size6 delimcenter" style="top: -0.05em;"><span class="delimsizing size4">]</span></span></span></span></span></span></span></span></p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi><mi>o</mi><mi>s</mi><mi>t</mi><mi>e</mi><mi>r</mi><mi>i</mi><mi>o</mi><mi>r</mi><mtext>&nbsp;</mtext><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mo>=</mo><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi><mtext>&nbsp;</mtext><mi>T</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>i</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mo>∗</mo><mi>P</mi><mi>r</mi><mi>i</mi><mi>o</mi><mi>r</mi><mtext>&nbsp;</mtext><mi>S</mi><mi>t</mi><mi>a</mi><mi>t</mi><mi>e</mi></mrow><annotation encoding="application/x-tex">Posterior \space State = State \space Transition *Prior \space State</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mord mathit">o</span><span class="mord mathit">s</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">i</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit"><span class="mspace">&nbsp;</span><span class="mord mathit" style="margin-right: 0.05764em;">S</span></span><span class="mord mathit">t</span><span class="mord mathit">a</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mrel">=</span><span class="mord mathit" style="margin-right: 0.05764em;">S</span><span class="mord mathit">t</span><span class="mord mathit">a</span><span class="mord mathit">t</span><span class="mord mathit">e</span><span class="mord mathit"><span class="mspace">&nbsp;</span><span class="mord mathit" style="margin-right: 0.13889em;">T</span></span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">a</span><span class="mord mathit">n</span><span class="mord mathit">s</span><span class="mord mathit">i</span><span class="mord mathit">t</span><span class="mord mathit">i</span><span class="mord mathit">o</span><span class="mord mathit">n</span><span class="mbin">∗</span><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit">i</span><span class="mord mathit">o</span><span class="mord mathit" style="margin-right: 0.02778em;">r</span><span class="mord mathit"><span class="mspace">&nbsp;</span><span class="mord mathit" style="margin-right: 0.05764em;">S</span></span><span class="mord mathit">t</span><span class="mord mathit">a</span><span class="mord mathit">t</span><span class="mord mathit">e</span></span></span></span></span></span></p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><msup><mi>x</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mi>F</mi><mi>x</mi></mstyle></mrow><annotation encoding="application/x-tex">\large x' = Fx</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.940048em;"></span><span class="strut bottom" style="height: 0.940048em; vertical-align: 0em;"></span><span class="base"><span class="mord sizing reset-size6 size7"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.783373em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel sizing reset-size6 size7">=</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.13889em;">F</span><span class="mord mathit sizing reset-size6 size7">x</span></span></span></span></span></span></p>
<h3 id="note-that-we-are-working-with-the-means-here-the-covariance-matrix-will-appear-later.">Note that we are working with the means here; the covariance matrix will appear later.</h3>
<p>If you multiply the matrices out, you have the same position update and velocity update as you had above. The new position is the prior position plus the time traveled multiplied by the velocity. The velocity is unchanged.</p>
<p>If we make the same assumption about the Kalman Filter executing one iteration per second as we did before, the matrix can be simplified to the one seen below.</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><msup><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mover accent="true"><mrow><mi>x</mi></mrow><mo>˙</mo></mover></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mo mathvariant="normal">′</mo></msup><mo>=</mo><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mover accent="true"><mrow><mi>x</mi></mrow><mo>˙</mo></mover></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mstyle></mrow><annotation encoding="application/x-tex">\large \begin{bmatrix} x \\ \dot{x} \end{bmatrix}' = \begin{bmatrix} 1 &amp; 1 \\ 0 &amp; 1 \end{bmatrix} \begin{bmatrix} x \\ \dot{x} \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 1.97205em;"></span><span class="strut bottom" style="height: 3.16208em; vertical-align: -1.19003em;"></span><span class="base"><span class="minner sizing reset-size6 size7"><span class="minner"><span class="mopen sizing reset-size7 size6 delimcenter" style="top: -0.05em;"><span class="delimsizing size4">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.81em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span class="" style="top: -2.61em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.66786em;"><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="accent-body" style="margin-left: 0.05556em;"><span class="">˙</span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"></span></span></span></span></span></span><span class="mclose sizing reset-size7 size6 delimcenter" style="top: -0.05em;"><span class="delimsizing size4">]</span></span></span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 1.64337em;"><span class="" style="top: -4.073em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel sizing reset-size6 size7">=</span><span class="minner sizing reset-size6 size7"><span class="mopen sizing reset-size7 size6 delimcenter" style="top: -0.05em;"><span class="delimsizing size4">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.81em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathrm">1</span></span></span><span class="" style="top: -2.61em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathrm">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.81em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathrm">1</span></span></span><span class="" style="top: -2.61em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathrm">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"></span></span></span></span></span></span><span class="mclose sizing reset-size7 size6 delimcenter" style="top: -0.05em;"><span class="delimsizing size4">]</span></span></span><span class="minner sizing reset-size6 size7"><span class="mopen sizing reset-size7 size6 delimcenter" style="top: -0.05em;"><span class="delimsizing size4">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.81em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span class="" style="top: -2.61em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.66786em;"><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="accent-body" style="margin-left: 0.05556em;"><span class="">˙</span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"></span></span></span></span></span></span><span class="mclose sizing reset-size7 size6 delimcenter" style="top: -0.05em;"><span class="delimsizing size4">]</span></span></span></span></span></span></span></span></p>
<p>The State Transition Function is denoted  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.13889em;">F</span></span></span></span></span>, and the formula can be written as so,</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><msup><mi>x</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mi>F</mi><mi>x</mi></mstyle></mrow><annotation encoding="application/x-tex">\large x' = Fx</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.940048em;"></span><span class="strut bottom" style="height: 0.940048em; vertical-align: 0em;"></span><span class="base"><span class="mord sizing reset-size6 size7"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.783373em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel sizing reset-size6 size7">=</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.13889em;">F</span><span class="mord mathit sizing reset-size6 size7">x</span></span></span></span></span></span></p>
<p>In reality, the equation should also account for process noise, as its own term in the equation. However, process noise is a Gaussian with a mean of 0, so the update equation need not include it because we are only working with the means.</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><msup><mi>x</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mi>F</mi><mi>x</mi><mo>+</mo><mi>n</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>e</mi></mstyle></mrow><annotation encoding="application/x-tex">\large x' = Fx + noise</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.940048em;"></span><span class="strut bottom" style="height: 1.04004em; vertical-align: -0.099996em;"></span><span class="base"><span class="mord sizing reset-size6 size7"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.783373em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel sizing reset-size6 size7">=</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.13889em;">F</span><span class="mord mathit sizing reset-size6 size7">x</span><span class="mbin sizing reset-size6 size7">+</span><span class="mord mathit sizing reset-size6 size7">n</span><span class="mord mathit sizing reset-size6 size7">o</span><span class="mord mathit sizing reset-size6 size7">i</span><span class="mord mathit sizing reset-size6 size7">s</span><span class="mord mathit sizing reset-size6 size7">e</span></span></span></span></span></span></p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi>n</mi><mi>o</mi><mi>i</mi><mi>s</mi><mi>e</mi><mo>∼</mo><mi>N</mi><mo>(</mo><mn>0</mn><mo separator="true">,</mo><mi>Q</mi><mo>)</mo></mstyle></mrow><annotation encoding="application/x-tex">\large noise \sim N(0,Q)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.9em;"></span><span class="strut bottom" style="height: 1.2em; vertical-align: -0.3em;"></span><span class="base"><span class="mord mathit sizing reset-size6 size7">n</span><span class="mord mathit sizing reset-size6 size7">o</span><span class="mord mathit sizing reset-size6 size7">i</span><span class="mord mathit sizing reset-size6 size7">s</span><span class="mord mathit sizing reset-size6 size7">e</span><span class="mrel sizing reset-size6 size7">∼</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.10903em;">N</span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathrm sizing reset-size6 size7">0</span><span class="mpunct sizing reset-size6 size7">,</span><span class="mord mathit sizing reset-size6 size7">Q</span><span class="mclose sizing reset-size6 size7">)</span></span></span></span></span></span></p>
<p>Now, what happens to the covariance, <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.13889em;">P</span></span></span></span></span>? How does it change in this process? Your intuition may suggest that it would be affected by the state transition function, and also by some additional uncertainty arising from the estimation. If so, you’re correct!</p>
<p><strong>Sidenote:</strong>  While it is common to use <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Σ</mi></mrow><annotation encoding="application/x-tex">\Sigma</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathrm">Σ</span></span></span></span></span>  to represent the covariance of a Gaussian distribution in mathematics, it is more common to use the letter  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.13889em;">P</span></span></span></span></span>  to represent the state covariance in localization.</p>
<p>To calculate the posterior covariance <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msup><mi>P</mi><mo mathvariant="normal">′</mo></msup></mrow><annotation encoding="application/x-tex">P'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.751892em;"></span><span class="strut bottom" style="height: 0.751892em; vertical-align: 0em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.751892em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span>, the prior covariance <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>P</mi></mrow><annotation encoding="application/x-tex">P</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.13889em;">P</span></span></span></span></span> would be multiplied by the state transition function <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>F</mi></mrow><annotation encoding="application/x-tex">F</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.13889em;">F</span></span></span></span></span>, and  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="base"><span class="mord mathit">Q</span></span></span></span></span>  added as an increase of uncertainty due to process noise.  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Q</mi></mrow><annotation encoding="application/x-tex">Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.87777em; vertical-align: -0.19444em;"></span><span class="base"><span class="mord mathit">Q</span></span></span></span></span>  can account for a robot slowing down unexpectedly, or being drawn off course by an external influence.</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><msup><mi>P</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mi>F</mi><mi>P</mi><msup><mi>F</mi><mi>T</mi></msup><mo>+</mo><mi>Q</mi></mstyle></mrow><annotation encoding="application/x-tex">\large P' = FPF^T + Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 1.04226em;"></span><span class="strut bottom" style="height: 1.27559em; vertical-align: -0.233328em;"></span><span class="base"><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.783373em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel sizing reset-size6 size7">=</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.13889em;">F</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.13889em;">P</span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.868553em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathit mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mbin sizing reset-size6 size7">+</span><span class="mord mathit sizing reset-size6 size7">Q</span></span></span></span></span></span></p>
<p>We’ve updated the mean and the covariance as part of the state prediction. Next, the measurement update must be converted to a similar linear algebra form.</p>
<h2 id="measurement-update">Measurement Update</h2>
<p>In our example, the measurements are only of the location, therefore the measurement function is very simple - a matrix containing a one and a zero. This matrix demonstrates how to map the state to the observation,  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>z</mi></mrow><annotation encoding="application/x-tex">z</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.43056em;"></span><span class="strut bottom" style="height: 0.43056em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.04398em;">z</span></span></span></span></span>.</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi>z</mi><mo>=</mo><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>1</mn></mrow></mstyle></mtd><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mn>0</mn></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow><mrow><mo fence="true">[</mo><mtable><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mi>x</mi></mrow></mstyle></mtd></mtr><mtr><mtd><mstyle scriptlevel="0" displaystyle="false"><mrow><mover accent="true"><mrow><mi>x</mi></mrow><mo>˙</mo></mover></mrow></mstyle></mtd></mtr></mtable><mo fence="true">]</mo></mrow></mstyle></mrow><annotation encoding="application/x-tex">\large z = \begin{bmatrix} 1 &amp; 0 \end{bmatrix} \begin{bmatrix} x \\ \dot{x} \end{bmatrix}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 1.81em;"></span><span class="strut bottom" style="height: 3.00003em; vertical-align: -1.19003em;"></span><span class="base"><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.04398em;">z</span><span class="mrel sizing reset-size6 size7">=</span><span class="minner sizing reset-size6 size7"><span class="mopen sizing reset-size7 size6 delimcenter" style="top: -0.05em;"><span class="delimsizing size2">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.85em;"><span class="" style="top: -3.21em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathrm">1</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.35em;"></span></span></span></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="arraycolsep" style="width: 0.5em;"></span><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.85em;"><span class="" style="top: -3.21em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathrm">0</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.35em;"></span></span></span></span></span></span><span class="mclose sizing reset-size7 size6 delimcenter" style="top: -0.05em;"><span class="delimsizing size2">]</span></span></span><span class="minner sizing reset-size6 size7"><span class="mopen sizing reset-size7 size6 delimcenter" style="top: -0.05em;"><span class="delimsizing size4">[</span></span><span class="mord"><span class="mtable"><span class="col-align-c"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.45em;"><span class="" style="top: -3.81em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span class="" style="top: -2.61em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord accent"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.66786em;"><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord"><span class="mord mathit">x</span></span></span><span class="" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="accent-body" style="margin-left: 0.05556em;"><span class="">˙</span></span></span></span></span></span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.95em;"></span></span></span></span></span></span><span class="mclose sizing reset-size7 size6 delimcenter" style="top: -0.05em;"><span class="delimsizing size4">]</span></span></span></span></span></span></span></span></p>
<p>This matrix, called the <strong>Measurement Function</strong>, is denoted  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>H</mi></mrow><annotation encoding="application/x-tex">H</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.08125em;">H</span></span></span></span></span>.</p>
<p>For the measurement update step, there are a few formulas. First, we calculate the <strong>Measurement Residual</strong>,  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>y</mi></mrow><annotation encoding="application/x-tex">y</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.43056em;"></span><span class="strut bottom" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.03588em;">y</span></span></span></span></span>. The measurement residual is the difference between the measurement and the expected measurement, based on prior state <strong>(ie. where the measurement tells us where we are vs. where we think we are)</strong>. The measurement residual will be used later on in a formula.</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi>y</mi><mo>=</mo><mi>z</mi><mo>−</mo><mi>H</mi><msup><mi>x</mi><mo mathvariant="normal">′</mo></msup></mstyle></mrow><annotation encoding="application/x-tex">\large y = z - Hx'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.940048em;"></span><span class="strut bottom" style="height: 1.17338em; vertical-align: -0.233328em;"></span><span class="base"><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.03588em;">y</span><span class="mrel sizing reset-size6 size7">=</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.04398em;">z</span><span class="mbin sizing reset-size6 size7">−</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.08125em;">H</span><span class="mord sizing reset-size6 size7"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.783373em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p>Next, it’s time to consider the measurement noise, denoted  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>R</mi></mrow><annotation encoding="application/x-tex">R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.00773em;">R</span></span></span></span></span>. This formula maps the state prediction covariance into the measurement space and adds the measurement noise. The result,  <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi></mrow><annotation encoding="application/x-tex">S</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.05764em;">S</span></span></span></span></span>, will be used in the following equation to calculate the Kalman Gain.</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi>S</mi><mo>=</mo><mi>H</mi><msup><mi>P</mi><mo mathvariant="normal">′</mo></msup><msup><mi>H</mi><mi>T</mi></msup><mo>+</mo><mi>R</mi></mstyle></mrow><annotation encoding="application/x-tex">\large S = HP'H^T + R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 1.04226em;"></span><span class="strut bottom" style="height: 1.14226em; vertical-align: -0.099996em;"></span><span class="base"><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.05764em;">S</span><span class="mrel sizing reset-size6 size7">=</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.08125em;">H</span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.783373em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.868553em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathit mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mbin sizing reset-size6 size7">+</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.00773em;">R</span></span></span></span></span></span></p>
<p>These equations need not be memorized, instead they can be referred to in text or implemented in code for use and reuse.</p>
<h2 id="kalman-gain">Kalman Gain</h2>
<p>Next, we calculate the Kalman Gain, <span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>K</mi></mrow><annotation encoding="application/x-tex">K</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.68333em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit" style="margin-right: 0.07153em;">K</span></span></span></span></span>. As you will see in the next equation, the Kalman Gain <strong>determines how much weight should be placed on the state prediction, and how much on the measurement update.</strong> It is an averaging factor that changes depending on the uncertainty of the state prediction and measurement update.</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi>K</mi><mo>=</mo><msup><mi>P</mi><mo mathvariant="normal">′</mo></msup><msup><mi>H</mi><mi>T</mi></msup><msup><mi>S</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mstyle></mrow><annotation encoding="application/x-tex">\large K = P'H^TS^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 1.04226em;"></span><span class="strut bottom" style="height: 1.04226em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.07153em;">K</span><span class="mrel sizing reset-size6 size7">=</span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.783373em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.868553em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathit mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.05764em;">S</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.842627em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathrm mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi>x</mi><mo>=</mo><msup><mi>x</mi><mo mathvariant="normal">′</mo></msup><mo>+</mo><mi>K</mi><mi>y</mi></mstyle></mrow><annotation encoding="application/x-tex">\large x = x' + Ky</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.940048em;"></span><span class="strut bottom" style="height: 1.17338em; vertical-align: -0.233328em;"></span><span class="base"><span class="mord mathit sizing reset-size6 size7">x</span><span class="mrel sizing reset-size6 size7">=</span><span class="mord sizing reset-size6 size7"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.783373em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mbin sizing reset-size6 size7">+</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.07153em;">K</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.03588em;">y</span></span></span></span></span></span></p>
<p>These equations may look complicated and intimidating, but they do nothing more than calculate an average factor. Let’s work through a quick example to gain a better understanding of this.</p>
<p><a href="https://youtu.be/K-FobmdRMtI"><img src="https://preview.ibb.co/cGOBtT/capture_screen_2.png" alt=""></a></p>
<p>The last step in the Kalman Filter is to update the new state’s covariance using the Kalman Gain.</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi>P</mi><mo>=</mo><mo>(</mo><mi>I</mi><mo>−</mo><mi>K</mi><mi>H</mi><mo>)</mo><msup><mi>P</mi><mo mathvariant="normal">′</mo></msup></mstyle></mrow><annotation encoding="application/x-tex">\large P = (I - KH)P'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.940048em;"></span><span class="strut bottom" style="height: 1.24005em; vertical-align: -0.3em;"></span><span class="base"><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.13889em;">P</span><span class="mrel sizing reset-size6 size7">=</span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.07847em;">I</span><span class="mbin sizing reset-size6 size7">−</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.07153em;">K</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.08125em;">H</span><span class="mclose sizing reset-size6 size7">)</span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.783373em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<h2 id="kalman-filter-equations">Kalman Filter Equations</h2>
<p>These are the equations that implement the Kalman Filter in multiple dimensions.</p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><msup><mi>x</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mi>F</mi><mi>x</mi></mstyle></mrow><annotation encoding="application/x-tex">\large x' = Fx</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.940048em;"></span><span class="strut bottom" style="height: 0.940048em; vertical-align: 0em;"></span><span class="base"><span class="mord sizing reset-size6 size7"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.783373em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel sizing reset-size6 size7">=</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.13889em;">F</span><span class="mord mathit sizing reset-size6 size7">x</span></span></span></span></span></span></p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><msup><mi>P</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mi>F</mi><mi>P</mi><msup><mi>F</mi><mi>T</mi></msup><mo>+</mo><mi>Q</mi></mstyle></mrow><annotation encoding="application/x-tex">\large P' = FPF^T + Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 1.04226em;"></span><span class="strut bottom" style="height: 1.27559em; vertical-align: -0.233328em;"></span><span class="base"><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.783373em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel sizing reset-size6 size7">=</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.13889em;">F</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.13889em;">P</span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.868553em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathit mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mbin sizing reset-size6 size7">+</span><span class="mord mathit sizing reset-size6 size7">Q</span></span></span></span></span></span></p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi>y</mi><mo>=</mo><mi>z</mi><mo>−</mo><mi>H</mi><msup><mi>x</mi><mo mathvariant="normal">′</mo></msup></mstyle></mrow><annotation encoding="application/x-tex">\large y = z - Hx'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.940048em;"></span><span class="strut bottom" style="height: 1.17338em; vertical-align: -0.233328em;"></span><span class="base"><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.03588em;">y</span><span class="mrel sizing reset-size6 size7">=</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.04398em;">z</span><span class="mbin sizing reset-size6 size7">−</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.08125em;">H</span><span class="mord sizing reset-size6 size7"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.783373em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi>S</mi><mo>=</mo><mi>H</mi><msup><mi>P</mi><mo mathvariant="normal">′</mo></msup><msup><mi>H</mi><mi>T</mi></msup><mo>+</mo><mi>R</mi></mstyle></mrow><annotation encoding="application/x-tex">\large S = HP'H^T + R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 1.04226em;"></span><span class="strut bottom" style="height: 1.14226em; vertical-align: -0.099996em;"></span><span class="base"><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.05764em;">S</span><span class="mrel sizing reset-size6 size7">=</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.08125em;">H</span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.783373em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.868553em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathit mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mbin sizing reset-size6 size7">+</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.00773em;">R</span></span></span></span></span></span></p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi>K</mi><mo>=</mo><msup><mi>P</mi><mo mathvariant="normal">′</mo></msup><msup><mi>H</mi><mi>T</mi></msup><msup><mi>S</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mstyle></mrow><annotation encoding="application/x-tex">\large K = P'H^TS^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 1.04226em;"></span><span class="strut bottom" style="height: 1.04226em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.07153em;">K</span><span class="mrel sizing reset-size6 size7">=</span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.783373em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.868553em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathit mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.05764em;">S</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.842627em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathrm mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi>x</mi><mo>=</mo><msup><mi>x</mi><mo mathvariant="normal">′</mo></msup><mo>+</mo><mi>K</mi><mi>y</mi></mstyle></mrow><annotation encoding="application/x-tex">\large x = x' + Ky</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.940048em;"></span><span class="strut bottom" style="height: 1.17338em; vertical-align: -0.233328em;"></span><span class="base"><span class="mord mathit sizing reset-size6 size7">x</span><span class="mrel sizing reset-size6 size7">=</span><span class="mord sizing reset-size6 size7"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.783373em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mbin sizing reset-size6 size7">+</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.07153em;">K</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.03588em;">y</span></span></span></span></span></span></p>
<p><span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi>P</mi><mo>=</mo><mo>(</mo><mi>I</mi><mo>−</mo><mi>K</mi><mi>H</mi><mo>)</mo><msup><mi>P</mi><mo mathvariant="normal">′</mo></msup></mstyle></mrow><annotation encoding="application/x-tex">\large P = (I - KH)P'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.940048em;"></span><span class="strut bottom" style="height: 1.24005em; vertical-align: -0.3em;"></span><span class="base"><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.13889em;">P</span><span class="mrel sizing reset-size6 size7">=</span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.07847em;">I</span><span class="mbin sizing reset-size6 size7">−</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.07153em;">K</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.08125em;">H</span><span class="mclose sizing reset-size6 size7">)</span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.783373em;"><span class="" style="top: -3.213em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></span></p>

<table>
<thead>
<tr>
<th>Symbol</th>
<th>Meaning</th>
<th>Formula</th>
</tr>
</thead>
<tbody>
<tr>
<td>x</td>
<td>Prior State</td>
<td></td>
</tr>
<tr>
<td>x’</td>
<td>Posterior State</td>
<td><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><msup><mi>x</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mi>F</mi><mi>x</mi></mstyle></mrow><annotation encoding="application/x-tex">\large x' = Fx</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.880048em;"></span><span class="strut bottom" style="height: 0.880048em; vertical-align: 0em;"></span><span class="base"><span class="mord sizing reset-size6 size7"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.733373em;"><span class="" style="top: -3.163em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel sizing reset-size6 size7">=</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.13889em;">F</span><span class="mord mathit sizing reset-size6 size7">x</span></span></span></span></span></td>
</tr>
<tr>
<td>F</td>
<td>State Transition Function</td>
<td></td>
</tr>
<tr>
<td>P</td>
<td>Prior Covariance</td>
<td></td>
</tr>
<tr>
<td>P’</td>
<td>Posterior Covariance</td>
<td><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><msup><mi>P</mi><mo mathvariant="normal">′</mo></msup><mo>=</mo><mi>F</mi><mi>P</mi><msup><mi>F</mi><mi>T</mi></msup><mo>+</mo><mi>Q</mi></mstyle></mrow><annotation encoding="application/x-tex">\large P' = FPF^T + Q</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.982264em;"></span><span class="strut bottom" style="height: 1.21559em; vertical-align: -0.233328em;"></span><span class="base"><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.733373em;"><span class="" style="top: -3.163em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mrel sizing reset-size6 size7">=</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.13889em;">F</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.13889em;">P</span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.13889em;">F</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.818553em;"><span class="" style="top: -3.163em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathit mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mbin sizing reset-size6 size7">+</span><span class="mord mathit sizing reset-size6 size7">Q</span></span></span></span></span></td>
</tr>
<tr>
<td>z</td>
<td>Observation</td>
<td></td>
</tr>
<tr>
<td>H</td>
<td>Measurement Function</td>
<td></td>
</tr>
<tr>
<td>y</td>
<td>Measurement Residual</td>
<td><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi>y</mi><mo>=</mo><mi>z</mi><mo>−</mo><mi>H</mi><msup><mi>x</mi><mo mathvariant="normal">′</mo></msup></mstyle></mrow><annotation encoding="application/x-tex">\large y = z - Hx'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.880048em;"></span><span class="strut bottom" style="height: 1.11338em; vertical-align: -0.233328em;"></span><span class="base"><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.03588em;">y</span><span class="mrel sizing reset-size6 size7">=</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.04398em;">z</span><span class="mbin sizing reset-size6 size7">−</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.08125em;">H</span><span class="mord sizing reset-size6 size7"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.733373em;"><span class="" style="top: -3.163em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td>
</tr>
<tr>
<td>R</td>
<td>Measurement Noise</td>
<td></td>
</tr>
<tr>
<td>S</td>
<td>State Prediction + Meas Noise</td>
<td><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi>S</mi><mo>=</mo><mi>H</mi><msup><mi>P</mi><mo mathvariant="normal">′</mo></msup><msup><mi>H</mi><mi>T</mi></msup><mo>+</mo><mi>R</mi></mstyle></mrow><annotation encoding="application/x-tex">\large S = HP'H^T + R</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.982264em;"></span><span class="strut bottom" style="height: 1.08226em; vertical-align: -0.099996em;"></span><span class="base"><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.05764em;">S</span><span class="mrel sizing reset-size6 size7">=</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.08125em;">H</span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.733373em;"><span class="" style="top: -3.163em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.818553em;"><span class="" style="top: -3.163em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathit mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mbin sizing reset-size6 size7">+</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.00773em;">R</span></span></span></span></span></td>
</tr>
<tr>
<td>K</td>
<td>Kalman Gain</td>
<td><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi>K</mi><mo>=</mo><msup><mi>P</mi><mo mathvariant="normal">′</mo></msup><msup><mi>H</mi><mi>T</mi></msup><msup><mi>S</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mstyle></mrow><annotation encoding="application/x-tex">\large K = P'H^TS^{-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.982264em;"></span><span class="strut bottom" style="height: 0.982264em; vertical-align: 0em;"></span><span class="base"><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.07153em;">K</span><span class="mrel sizing reset-size6 size7">=</span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.733373em;"><span class="" style="top: -3.163em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.08125em;">H</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.818553em;"><span class="" style="top: -3.163em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mathit mtight" style="margin-right: 0.13889em;">T</span></span></span></span></span></span></span></span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.05764em;">S</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.792627em;"><span class="" style="top: -3.163em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mathrm mtight">1</span></span></span></span></span></span></span></span></span></span></span></span></span></td>
</tr>
<tr>
<td></td>
<td>Not sure about the ones below</td>
<td></td>
</tr>
<tr>
<td><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>P</mi><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msub></mrow><annotation encoding="application/x-tex">P_{new}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.68333em;"></span><span class="strut bottom" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">n</span><span class="mord mathit mtight">e</span><span class="mord mathit mtight" style="margin-right: 0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span></span></span></span></span> ??</td>
<td>New State Covariance Updated  with Kalman Gain</td>
<td><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi>P</mi><mo>=</mo><mo>(</mo><mi>I</mi><mo>−</mo><mi>K</mi><mi>H</mi><mo>)</mo><msup><mi>P</mi><mo mathvariant="normal">′</mo></msup></mstyle></mrow><annotation encoding="application/x-tex">\large P = (I - KH)P'</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.9em;"></span><span class="strut bottom" style="height: 1.2em; vertical-align: -0.3em;"></span><span class="base"><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.13889em;">P</span><span class="mrel sizing reset-size6 size7">=</span><span class="mopen sizing reset-size6 size7">(</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.07847em;">I</span><span class="mbin sizing reset-size6 size7">−</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.07153em;">K</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.08125em;">H</span><span class="mclose sizing reset-size6 size7">)</span><span class="mord sizing reset-size6 size7"><span class="mord mathit" style="margin-right: 0.13889em;">P</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.733373em;"><span class="" style="top: -3.163em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span></span></span></span></span></td>
</tr>
<tr>
<td><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mrow><mi>n</mi><mi>e</mi><mi>w</mi></mrow></msub></mrow><annotation encoding="application/x-tex">x_{new}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.43056em;"></span><span class="strut bottom" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="base"><span class="mord"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.151392em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathit mtight">n</span><span class="mord mathit mtight">e</span><span class="mord mathit mtight" style="margin-right: 0.02691em;">w</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"></span></span></span></span></span></span></span></span></span> ??</td>
<td>New State Updated  with Kalman Gain ???</td>
<td><span class="katex--inline"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mstyle mathsize="1.2em"><mi>x</mi><mo>=</mo><msup><mi>x</mi><mo mathvariant="normal">′</mo></msup><mo>+</mo><mi>K</mi><mi>y</mi></mstyle></mrow><annotation encoding="application/x-tex">\large x = x' + Ky</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="strut" style="height: 0.880048em;"></span><span class="strut bottom" style="height: 1.11338em; vertical-align: -0.233328em;"></span><span class="base"><span class="mord mathit sizing reset-size6 size7">x</span><span class="mrel sizing reset-size6 size7">=</span><span class="mord sizing reset-size6 size7"><span class="mord mathit">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.733373em;"><span class="" style="top: -3.163em; margin-right: 0.0416667em;"><span class="pstrut" style="height: 2.8em;"></span><span class="sizing reset-size7 size4 mtight"><span class="mord mtight"><span class="mord mathrm mtight">′</span></span></span></span></span></span></span></span></span><span class="mbin sizing reset-size6 size7">+</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.07153em;">K</span><span class="mord mathit sizing reset-size6 size7" style="margin-right: 0.03588em;">y</span></span></span></span></span></td>
</tr>
</tbody>
</table><p>The Kalman Filter can successfully recover from inaccurate initial estimates, but it is very important to estimate the noise parameters as accurately as possible - as they are used to determine which of the estimate or the measurement to believe more.</p>
<p>Now it’s your chance to code the multi-dimensional Kalman Filter in C++. The code below uses the C++  <code>eigen</code>  library to define matrices and easily compute their inverse and transpose. Check out the  <code>eigen</code>library full documentation  <a href="https://eigen.tuxfamily.org/dox/group__QuickRefPage.html">here</a>  and go through some of their examples. Here’s a list of useful commands that you’ll need while working on this quiz:</p>
<ul>
<li>Initializing a 2x1 float matrix  <strong>K</strong>:  <code>MatrixXf K(2, 1)</code>;</li>
<li>Inserting values to matrix  <strong>K</strong>:  <code>K &lt;&lt; 0, 0</code></li>
<li>Computing the transpose of matrix  <strong>K</strong>:  <code>K.transpose()</code></li>
<li>Computing the inverse of matrix  <strong>K</strong>:  <code>K.inverse()</code></li>
</ul>
<pre><code>#include &lt;iostream&gt;
#include &lt;math.h&gt;
#include &lt;tuple&gt;
#include "Core" // Eigen Library
#include "LU"   // Eigen Library
using namespace std;
using namespace Eigen;
float measurements[3] = { 1, 2, 3 };

tuple&lt;MatrixXf, MatrixXf&gt; kalman_filter(MatrixXf x, MatrixXf P, MatrixXf u, MatrixXf F, MatrixXf H, MatrixXf R, MatrixXf I)
{
    for (int n = 0; n &lt; sizeof(measurements) / sizeof(measurements[0]); n++) {
        //****** TODO: Kalman-filter function********//
        // Measurement Update
        // Initialize and Compute Z, y, S, K, x, and P
        MatrixXf Z(1, 1);
        Z &lt;&lt; measurements[n];

        MatrixXf y(1, 1);
        y &lt;&lt; Z - (H * x);

        MatrixXf S(1, 1);
        S &lt;&lt; H * P * H.transpose() + R;

        MatrixXf K(2, 1);
        K &lt;&lt; P * H.transpose() * S.inverse();

        x &lt;&lt; x + (K * y);

        P &lt;&lt; (I - (K * H)) * P;
        
        // Prediction
        // Compute x and P
        x &lt;&lt; (F * x) + u;
        P &lt;&lt; F * P * F.transpose();
    }
    return make_tuple(x, P);
}


int main()
{

    MatrixXf x(2, 1);// Initial state (location and velocity) 
    x &lt;&lt; 0,
    	 0; 
    MatrixXf P(2, 2);//Initial Uncertainty
    P &lt;&lt; 100, 0, 
    	 0, 100; 
    MatrixXf u(2, 1);// External Motion
    u &lt;&lt; 0,
    	 0; 
    MatrixXf F(2, 2);//Next State Function
    F &lt;&lt; 1, 1,
    	 0, 1; 
    MatrixXf H(1, 2);//Measurement Function
    H &lt;&lt; 1,
    	 0; 
    MatrixXf R(1, 1); //Measurement Uncertainty
    R &lt;&lt; 1;
    MatrixXf I(2, 2);// Identity Matrix
    I &lt;&lt; 1, 0,
    	 0, 1; 

    tie(x, P) = kalman_filter(x, P, u, F, H, R, I);
    cout &lt;&lt; "x= " &lt;&lt; x &lt;&lt; endl;
    cout &lt;&lt; "P= " &lt;&lt; P &lt;&lt; endl;

    return 0;
}
</code></pre>

    </div>
  </div>
</body>

</html>
